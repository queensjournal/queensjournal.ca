{% extends 'single.html' %}
{% load navigation %}
{% load typogrify_tags %}
{% load custom_html %}
{% load sanitize %}
{% load comparison %}
{% load tagging_tags %}
{% load shorturl %}

{% block meta %}
<meta name="description" content="{{ story.summary }}" />
{% endblock meta %}

{% block og_meta %}
<meta property="og:title" content="{{ story.head }}" />
<meta property="og:type" content="article" />
<meta property="og:url" content="{% shorturl story %}" />
<meta property="og:image" content="{{ story.story_thumb.thumbnail_image.url }}" />
{% endblock %}

{% if story.issue %}
{% block header_issue %}{{ story.issue }}{% endblock %}
{% endif %}

{% block content %}
<div id="story" class="story clearfix">

    {% if story.storyphoto_set.all|length > 0 %}
    <div id="top-photo" class="story" style="{% if story.first_photo.first.width < 500 %}float:right;{% endif %}width:{{story.first_photo.first.width}}px">
        <img src="{{ story.first_photo.first.url }}" alt="{{story.first_photo.caption|striptags}}"/>
        <div id="caption-top">
            {{ story.first_photo.caption }}{% ifnotequal story.first_photo.list_photographer '[no credit]' %} ({{ story.first_photo.list_photographer|safe }}){% endifnotequal %}
        </div>
    </div>
    {% endif %}

    <div id="story-socmedia">
        <p class="label">Share<p>
                <hr>
                <script src="http://connect.facebook.net/en_US/all.js#xfbml=1"></script><fb:like href="{% shorturl story%}" layout="button_count" show_faces="false" width="100" font=""></fb:like>
                <br/>
                <a href="http://twitter.com/share" class="twitter-share-button" data-url="{% shorturl story %}" data-count="horizontal" data-via="queensjournal">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
                <br/>
                <a href="http://www.reddit.com/submit" onclick="window.location = 'http://www.reddit.com/submit?url=' + encodeURIComponent(window.location); return false"> <img src="http://www.reddit.com/static/spreddit7.gif" alt="submit to reddit" border="0" /> </a>
                <br/>
                <g:plusone></g:plusone>
                <hr>
                {% tags_for_object story as tags %}
                {% if tags %}
                <h4>Article tags:</h4>
                <ul>
                    {% for tag in tags %}
                    <li><a href="/tag/{{tag.name|urlencode}}/">{{ tag }}</a></li>
                    {% endfor %}
                </ul>{% endif %}
                <ul class="story-actions">
                    <li><a href="javascript:print_preview()">print <img src="{{ STATIC_URL }}img/icon_print.gif" /></a></li>
                    <hr>
                    <li><span class="label">Short URL:</span>
                        <form action="" method="get">
                            <input type="text" id="shorturl" onclick="this.select();" value="{% shorturl story %}" readonly="false" />
                    </form></li>
                </ul>
                {% revcanonical story %}

            </div>

            {% if story.show_headshots %}
            {% for sauthor in story.storyauthor_set.all %}
            <div class="headshot"><img src="{{ sauthor.author.headshot.display.url }}" /><br/>
                <a href="{{ sauthor.author.get_absolute_url }}">{{ sauthor.author.name }}</a></div>
            {% endfor %}
            {% endif %}

            {% if story.has_inlines %}
            <div class="story-inlines">
                {% for factbox in story.factbox_set.all %}
                {% if not factbox.full_width %}
                <div class="inline-container factbox">
                    <h4>{{ factbox.head|widont }}</h4>
                    {{ factbox.body|sanitize:"h4 strong em a ul li table tr td tbody thead tfoot th,"|typogrify|linebreakswithcode|safe }}
                    {% if factbox.source %}<p class="factbox-source">&mdash;{{ factbox.source }}</p>{% endif %}
                </div>
                {% endif %}
                {% endfor %}
                {% for document in story.document_set.all %}
                <div class="inline-container document">
                    <h4>{{ document.head|widont }}</h4>
                    {% if document.body %}<p>{{ document.body|typogrify }}</p>{% endif %}
                    <ul>
                        {% for file in document.files.all %}
                        <li>{% filter widont %}<a href="{{ file.get_file_obj_url }}">{{ file.name }}</a> <span class="doc-details">({{ file.get_file_obj_size|filesizeformat }})</span>{% endfilter %}{% if file.caption %}<p class="doc-caption">{{ file.caption }}</p>{% endif %}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endfor %}
                </div>
                {% endif %}
                <div class="story-content">

                    {% if story.storyphoto_set.all|length > 1 %}
                    {{ story.content|paragraphs:'0:12'|typogrify|linebreakswithcode|urlize|safe }}

                    {% for photo in story.other_photos %}
                    <div class="other-photo">
                        <img src="{{ photo.photo.other.url }}" alt="{{ photo.photo.caption|striptags }}">
                        <div id="caption-top">
                            {{ photo.photo.caption }}{% ifnotequal photo.photo.list_photographer '[no credit]' %} ({{ photo.photo.list_photographer|safe }}){% endifnotequal %}
                        </div>
                    </div>
                    {% endfor %}

                    {{ story.content|paragraphs:'12:'|safe|linebreakswithcode|typogrify|urlize }}

                    {% else %}

                    {{ story.content|safe|linebreaks|typogrify|urlize }}

                    {% endif %}

                    {% if story.gallery_set.all %}
                    {% for gallery in story.gallery_set.all %}
                    <div class="gallery-container">
                        <h4><strong>Gallery &gt;&gt;</strong> {{ gallery.name|widont }}</h4>
                        <div class="thumbs-container">
                            {% for image in gallery.images.all %}
                            <a class="gallery" rel="{{ gallery.name|slugify }}" href="{{ image.gallery_image.url }}"{% if image.caption %} title="{{ image.caption|escape }} ({{ image.list_photographer|striptags }})"{% endif %}><img src="{{ image.thumbnail_image.url }}" alt="{{ image.caption }}"/></a>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                    {% endif %}
                    {% if story.has_wide_inlines %}
                    {% for factbox in story.factbox_set.all %}
                    {% if factbox.full_width %}
                    <div class="inline-container factbox">
                        <h4>{{ factbox.head|widont }}</h4>
                        {{ factbox.body|sanitize:"h4 strong em a ul li table tr td th tbody thead tfoot,"|typogrify|linebreakswithcode|safe }}
                        {% if factbox.source %}<p class="factbox-source">&mdash;{{ factbox.source }}</p>{% endif %}
                    </div>
                    {% endif %}
                    {% endfor %}
                    {% endif %}

                    {% include "ads/in-story.html" %}


                    </div>
                </div>
                {% endblock content %}
                <!-- google_ad_section_end -->


{% block title %}{{ story.title }} - {{ block.super }}{% endblock title %}

{% block breadcrumb-extend %}
<a class="last-child" href="{% url "stories-index-section" story.section.slug %}">{{ story.section }}</a>
{% endblock %}

{% block main %}
{{ story.content|safe|linebreaks|typogrify|urlize }}
{% endblock %}
